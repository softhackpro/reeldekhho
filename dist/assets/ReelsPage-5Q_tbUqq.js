import{c as V,r as l,b as N,d as D,e as O,j as e,L as F,S as C}from"./index-4-6_qnaC.js";import{u as P}from"./useIntersectionObserver-Dwi2r5Zb.js";import{B as T}from"./index-A81nn3nl.js";import{u as A,H as L,M as S,B as W,C as q}from"./CommentSection-B6B3YB4t.js";import{B as R}from"./bookmark-CZ_SJnD4.js";import"./iconBase-CinpP4O6.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=V("Music2",[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]]),J=s=>{const[g,n]=l.useState(!0),[x,o]=l.useState(null),[r,t]=l.useState(!1),[m,h]=l.useState(0);return l.useEffect(()=>{m||(async()=>{var d,w;if(s){console.log("I am run "),n(!0);try{const u=await N.get(`/post/getlikes?postId=${s}`);h(u.data.likesCount),t(u.data.isCurrUserLiked),console.log(u.data)}catch(u){o(((w=(d=u==null?void 0:u.response)==null?void 0:d.data)==null?void 0:w.message)||"Something went wrong")}finally{n(!1)}}})(),n(!1)},[s]),{likeCount:m,loading:g,error:x,isLiked:r,likePost:async()=>{if(s){console.log("I am run ");try{const i=r?m-1:m+1;h(i),t(!r),await N.post(`/post/like?postId=${s}`)}catch{o("Failed to update like status")}}}}};function K({reel:s}){const{isLoggedIn:g}=D(),[n,x]=l.useState(!1),[o,r]=l.useState(!1),[t,m]=l.useState(!1),h=O(),{isLiked:c,likeCount:i,likePost:d}=J(s._id),{getComment:w,createComment:u,deleteComment:b,comments:j}=A(s._id);l.useRef(null);const[v,k]=l.useState({addLoader:!1,removeLoader:!1}),[_,y]=l.useState(!1),f=P(()=>r(!0),()=>r(!1),{threshold:.5});l.useEffect(()=>{f.current&&s.file.url.includes("video/")&&(o?(f.current.currentTime=0,f.current.play()):f.current.pause())},[o,s.file.fileType]);const $=async a=>{a.stopPropagation(),await d(postMessage._id)},E=a=>{a.stopPropagation(),x(!n)},M=()=>{var a,p;s.file.url.includes("video/")&&((a=f.current)!=null&&a.paused?f.current.play():(p=f.current)==null||p.pause())},U=a=>{a.stopPropagation(),m(!0)},z=a=>{window.location.href=a},B=()=>{m(!1)},H=a=>{v.removeLoader||(k(p=>({...p,removeLoader:!0})),b(a),y(!1),k(p=>({...p,removeLoader:!1})))};return e.jsxs("div",{onClick:M,className:"reel relative z-10 h-[100dvh] bg-black bg-inherit w-full snap-start overflow-hidden",children:[s.file.url.includes("image/")?e.jsx("img",{src:s.file.url,alt:s.caption||"Reel Image",className:"w-full h-full object-cover",loading:"lazy"}):e.jsx("video",{ref:f,src:s.file.url,className:"w-full h-full",loop:!0,playsInline:!0},s._id),e.jsxs("div",{className:"absolute inset-0 bottom-12 top-0",children:[e.jsxs("div",{className:"absolute bottom-0 left-0 right-12 p-4",children:[e.jsxs(F,{to:`/seller/${s.user._id}`,className:"flex items-center space-x-2 mb-3",children:[e.jsx("img",{src:s.user.profilePicture||"https://cdn.pixabay.com/photo/2023/12/04/06/14/ai-generated-8428762_1280.jpg",alt:`${s.user.fullName}'s avatar`,className:"w-8 h-8 rounded-full border border-white",loading:"lazy"}),e.jsx("span",{className:"text-white font-medium text-sm",children:s.user.fullName||"Unknown User"})]}),e.jsx("p",{className:"text-white text-sm mb-2 line-clamp-2",children:s.caption}),e.jsxs("div",{className:"flex items-center space-x-2 text-white",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs",children:s.category})]})]}),e.jsxs("div",{className:"absolute bottom-4 right-2 space-y-4",children:[e.jsx("button",{onClick:()=>z(`https://wa.me/${s.user.phone||"9955099966"}`),className:"flex flex-col items-center",children:e.jsx(T,{className:"w-6 h-6 transition-colors text-white"})}),g?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:$,className:"flex flex-col items-center","aria-label":c?"Unlike":"Like",children:[e.jsx(L,{className:`w-6 h-6 transition-colors ${c?"text-red-500 fill-current":"text-white"}`}),e.jsx("span",{className:"text-white text-xs mt-1",children:i.toLocaleString()})]}),e.jsxs("button",{onClick:U,className:"flex flex-col items-center","aria-label":"Comment",children:[e.jsx(S,{className:"w-6 h-6 text-white"}),e.jsxs("span",{className:"text-white text-xs mt-1",children:[" ",j.length||0," "]})]}),e.jsx("button",{className:"flex flex-col items-center","aria-label":"Share",children:e.jsx(C,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:E,className:"flex flex-col items-center","aria-label":n?"Unsave":"Save",children:e.jsx(R,{className:`w-6 h-6 transition-colors ${n?"text-white fill-current":"text-white"}`})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>h("/signup"),className:"flex flex-col items-center","aria-label":c?"Unlike":"Like",children:[e.jsx(L,{className:`w-6 h-6 transition-colors ${c?"text-red-500 fill-current":"text-white"}`}),e.jsx("span",{className:"text-white text-xs mt-1",children:i.toLocaleString()})]}),e.jsxs("button",{onClick:()=>h("/signup"),className:"flex flex-col items-center","aria-label":"Comment",children:[e.jsx(S,{className:"w-6 h-6 text-white"}),e.jsxs("span",{className:"text-white text-xs mt-1",children:[" ",(j==null?void 0:j.length)||0," "]})]}),e.jsx("button",{onClick:()=>h("/signup"),className:"flex flex-col items-center","aria-label":"Share",children:e.jsx(C,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:()=>h("/signup"),className:"flex flex-col items-center","aria-label":n?"Unsave":"Save",children:e.jsx(R,{className:`w-6 h-6 transition-colors ${n?"text-white fill-current":"text-white"}`})})]})]})]}),t?e.jsxs("div",{className:`absolute z-50  overflow-y-scroll bottom-0 left-0 right-0 bg-gray-900 text-white p-4 rounded-t-lg transform transition-transform duration-300 ${t?"translate-y-0":"translate-y-full"}`,style:{height:"50%"},children:[e.jsxs("div",{className:"flex sticky top-0 bg-inherit z-40  justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Comments"}),e.jsx("button",{onClick:B,className:"text-white hover:text-gray-400",children:"Close"})]}),e.jsx("div",{className:"space-y-4 w-full h-full",children:j&&j.length?j.map(a=>e.jsxs("div",{className:"flex items-start space-x-4 mb-2",children:[e.jsx("img",{src:a.user.profilePicture,alt:a.user.fullName,className:"w-8 h-8 rounded-full object-cover"}),e.jsxs("div",{className:"flex-grow h-full items-start flex flex-col",children:[e.jsx("p",{className:"font-semibold dark:text-white",children:a.user.fullName}),e.jsx("p",{className:"dark:text-white",children:a.text})]}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"dark:text-white text-black text-lg cursor-pointer",onClick:()=>y(p=>p===a._id?!1:a._id)}),_===a._id&&e.jsx("div",{className:"absolute top-full right-[21px] mt-[-24px] rounded-sm",children:e.jsx("p",{className:" text-white font-semibold rounded-sm cursor-pointer text-sm p-2 bg-red-500  hover:underline",onClick:()=>H(a._id),children:v.removeLoader?"loading...":"Delete"})})]})]},a._id)):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No comments yet"})}),e.jsx("div",{className:" sticky bottom-14 bg-inherit top-0 w-full ",children:e.jsx(q,{postId:s.id,createComment:u,loader:v,setLoader:k})})]}):e.jsx("div",{children:"No any comment yet"})]})}let I=1;const Q=()=>{const[s,g]=l.useState([]),n=async()=>{var o,r;try{const t=await N.get("/post/get");g(t.data.posts),console.log(t.data.posts)}catch(t){console.error((r=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:r.error)}},x=async()=>{var o,r;try{const t=await N.get("/post/get?page="+I);g([...s,...t.data.posts]),t.data.posts.length>0&&I++,console.log(t.data.posts)}catch(t){console.error((r=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:r.error)}};return l.useEffect(()=>{n()},[]),{reels:s,loadReels:x}};function X(){const[s,g]=l.useState(!0),{loadReels:n,reels:x}=Q(),o=l.useRef(null),r=l.useRef([]),t=l.useRef(0),m=c=>{const i=r.current[c];i&&i.scrollIntoView({behavior:"smooth",block:"start"})};l.useEffect(()=>{const c=new IntersectionObserver(i=>{let d=-1;i.forEach(w=>{if(w.isIntersecting){const u=r.current.findIndex(b=>b===w.target);u!==-1&&(d=u)}}),d!==-1&&d!==t.current&&(t.current=d,m(d))},{threshold:.6});return r.current.forEach(i=>{i&&c.observe(i)}),()=>{c.disconnect()}},[x]);const h=P(()=>n(),()=>{},{threshold:1});return e.jsx("div",{className:"h-[100dvh] w-full max-w-md m-auto bg-black overflow-hidden",children:e.jsxs("div",{ref:o,className:"h-full scrollbar-hide overflow-y-scroll snap-mandatory snap-y",children:[x.map((c,i)=>e.jsx("div",{ref:d=>r.current[i]=d,className:"snap-start h-full",children:e.jsx(K,{reel:c})},i)),e.jsx("div",{ref:h,className:"relative flex justify-center items-center dark:text-white text-black z-10 h-8 w-full snap-start bg-black overflow-hidden",children:s?e.jsx("p",{children:"Loading more reels..."}):e.jsx("p",{children:"No more reels!"})})]})})}function le(){return e.jsx("div",{className:"h-[100dvh] w-full relative m-auto ",children:e.jsx(X,{})})}export{le as default};
