import{i as E,G as _,r,u as w,a as B,b as P,s as S,j as e,g as Q,h as ee,J as te,f as se,L as ae,m as re,H as z,M as A,S as R,K as ne,N as oe,O as ie,P as le}from"./index-Deeox68m.js";import{u as ce}from"./Feed-DT3ay1QO.js";import"./HeaderStatic-D0uLpqn3.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=E("BookmarkX",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m14.5 7.5-5 5",key:"3lb6iw"}],["path",{d:"m9.5 7.5 5 5",key:"ko136h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=E("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=E("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);function me(t){return _({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"32",d:"M416 432 64 80"},child:[]},{tag:"path",attr:{d:"M243.33 98.86a23.89 23.89 0 0 0-25.55 1.82l-.66.51-28.52 23.35a8 8 0 0 0-.59 11.85l54.33 54.33a8 8 0 0 0 13.66-5.66v-64.49a24.51 24.51 0 0 0-12.67-21.71zm8 236.43L96.69 180.69A16 16 0 0 0 85.38 176H56a24 24 0 0 0-24 24v112a24 24 0 0 0 24 24h69.76l92 75.31a23.9 23.9 0 0 0 25.87 1.69A24.51 24.51 0 0 0 256 391.45v-44.86a16 16 0 0 0-4.67-11.3zM352 256c0-24.56-5.81-47.87-17.75-71.27a16 16 0 1 0-28.5 14.55C315.34 218.06 320 236.62 320 256q0 4-.31 8.13a8 8 0 0 0 2.32 6.25l14.36 14.36a8 8 0 0 0 13.55-4.31A146 146 0 0 0 352 256zm64 0c0-51.18-13.08-83.89-34.18-120.06a16 16 0 0 0-27.64 16.12C373.07 184.44 384 211.83 384 256c0 23.83-3.29 42.88-9.37 60.65a8 8 0 0 0 1.9 8.26L389 337.4a8 8 0 0 0 13.13-2.79C411 311.76 416 287.26 416 256z"},child:[]},{tag:"path",attr:{d:"M480 256c0-74.25-20.19-121.11-50.51-168.61a16 16 0 1 0-27 17.22C429.82 147.38 448 189.5 448 256c0 46.19-8.43 80.27-22.43 110.53a8 8 0 0 0 1.59 9l11.92 11.92a8 8 0 0 0 12.92-2.16C471.6 344.9 480 305 480 256z"},child:[]}]})(t)}function xe(t){return _({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M11.553 3.064A.75.75 0 0 1 12 3.75v16.5a.75.75 0 0 1-1.255.555L5.46 16H2.75A1.75 1.75 0 0 1 1 14.25v-4.5C1 8.784 1.784 8 2.75 8h2.71l5.285-4.805a.752.752 0 0 1 .808-.13ZM10.5 5.445l-4.245 3.86a.748.748 0 0 1-.505.195h-3a.25.25 0 0 0-.25.25v4.5c0 .138.112.25.25.25h3c.187 0 .367.069.505.195l4.245 3.86Zm8.218-1.223a.75.75 0 0 1 1.06 0c4.296 4.296 4.296 11.26 0 15.556a.75.75 0 0 1-1.06-1.06 9.5 9.5 0 0 0 0-13.436.75.75 0 0 1 0-1.06Z"},child:[]},{tag:"path",attr:{d:"M16.243 7.757a.75.75 0 1 0-1.061 1.061 4.5 4.5 0 0 1 0 6.364.75.75 0 0 0 1.06 1.06 6 6 0 0 0 0-8.485Z"},child:[]}]})(t)}const fe=t=>{const[d,i]=r.useState(!0),[c,o]=r.useState(null),l=w(x=>{var a;return((a=x.post.likes.find(u=>u.id===t))==null?void 0:a.isLiked)||!1}),n=w(x=>{var a;return((a=x.post.likes.find(u=>u.id===t))==null?void 0:a.likeCount)||0}),g=B();return r.useEffect(()=>{if(!t)return;n||(async()=>{var a,u;i(!0);try{const m=await P.get(`/post/getlikes?postId=${t}`);g(S({type:"SET_LIKE",payload:{id:t,likeCount:m.data.likesCount,isLiked:m.data.isCurrUserLiked}}))}catch(m){o(((u=(a=m==null?void 0:m.response)==null?void 0:a.data)==null?void 0:u.message)||"Something went wrong")}finally{i(!1)}})()},[t,g,n]),{likeCount:n,loading:d,error:c,isLiked:l,likePost:async()=>{if(!t)return;const x=l?n-1:n+1;try{g(S({type:"SET_LIKE",payload:{id:t,likeCount:x,isLiked:!l}}));const a=await P.post(`/post/like?postId=${t}`);console.log(a)}catch{g(S({type:"SET_LIKE",payload:{id:t,likeCount:n,isLiked:l}})),o("Failed to update like status")}}}};function ge(t){return _({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"},child:[]},{tag:"circle",attr:{cx:"12",cy:"10",r:"3"},child:[]}]})(t)}const ke=({latitude:t,longitude:d})=>{const[i,c]=r.useState(null),[o,l]=r.useState(null),n=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(h=>{const{latitude:x,longitude:a}=h.coords;c({lat:x,lng:a}),l(null)},h=>{l(h.message||"Unable to retrieve your location.")}):l("Geolocation is not supported by this browser.")};r.useEffect(()=>{n()},[]);const g=()=>{if(i){const h=$=>$*Math.PI/180,a=t||23.35315,u=d||85.310927,m=h(a-i.lat),p=h(u-i.lng),k=Math.sin(m/2)*Math.sin(m/2)+Math.cos(h(i.lat))*Math.cos(h(a))*Math.sin(p/2)*Math.sin(p/2);return(6371*(2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k)))).toFixed(2)+" km"}return"Calculating..."};return e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("span",{className:"flex items-center text-xs",children:[e.jsx(ge,{className:"mr-1",style:{height:"22px",width:"22px"}}),e.jsx("span",{style:{fontSize:"15px",color:"blue"},children:i?g():o||"Fetching location..."})]})})};function pe(t){const d=new Date,i=new Date(t),c=Math.floor((d.getTime()-i.getTime())/1e3);if(c<60)return`${c}s`;const o=Math.floor(c/60);if(o<60)return`${o}m`;const l=Math.floor(o/60);if(l<24)return`${l}h`;const n=Math.floor(l/24);return n<7?`${n}d`:`${Math.floor(n/7)}w`}const ve=t=>{const d=["jpg","jpeg","png","gif","bmp","webp"],i=["mp4","mov","avi","mkv","webm","flv"],c=t==null?void 0:t.toLowerCase();return d.some(o=>c.includes(o))?"image":i.some(o=>c.includes(o))?"video":"unknown"};function Ne({post:t}){const d=Q(),{isLoggedIn:i}=ee(),[c,o]=r.useState(!0),[l,n]=r.useState(!1),[g,h]=r.useState(!1),[x,a]=r.useState(!1),{likeCount:u,isLiked:m,likePost:p}=fe(t._id),k=w(s=>s.auth.isMute),I=B(),{getComment:$,createComment:F,deleteComment:T,comments:j}=te(t._id),y=r.useRef(null),b=r.useRef(null),[N,C]=r.useState({addLoader:!1,removeLoader:!1}),{addSavedPost:H,getSavedPosts:we,removeSavedPost:V}=ce(),L=w(s=>s.savedPosts.saved_Posts);r.useEffect(()=>{const s=L.find(f=>f.postId._id===t._id);console.log(L,t._id),console.log("useeffect ran",s),h(!!s)},[L]);const[U,D]=r.useState(!1),v=se(()=>o(!0),()=>o(!1),{threshold:.6});r.useEffect(()=>{v.current&&(c?v.current.play():v.current.pause())},[c]);const M=async()=>{await p(t.id)},G=ve(t.file.fileType),Z=()=>{I(le(!k))},[K,O]=r.useState(!1),W=s=>{N.removeLoader||(C(f=>({...f,removeLoader:!0})),T(s),O(!1),C(f=>({...f,removeLoader:!1})))};r.useEffect(()=>{const s=f=>{y.current&&!y.current.contains(f.target)&&a(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]),r.useEffect(()=>{const s=f=>{b.current&&!b.current.contains(f.target)&&n(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]);const q=()=>{H(t._id),n(!1)},X=()=>{V(t._id),n(!1)},J=async()=>{try{const s=await P.post(`/post/report-post?id=${t._id}`);console.log(s.data)}catch(s){console.log(s),alert(s.response.data.message||"Something went wrong!")}finally{n(!1)}},Y=()=>{n(!l)};return e.jsxs("div",{className:" bg-white  w-full max-w-lg dark:bg-gray-800 border dark:border-gray-700 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs(ae,{to:`/seller/${t.user._id}`,className:"flex items-center space-x-2",children:[e.jsx("img",{src:t.user.profilePicture,alt:t.user.fullName,className:"w-8 h-8 rounded-full object-cover"}),e.jsx("span",{className:"font-semibold dark:text-white",children:t.user.fullName})]}),e.jsx("button",{onClick:Y,className:"dark:text-white",children:e.jsx(he,{className:"cursor-pointer"})}),l&&e.jsx("div",{ref:b,className:"absolute top-0 right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-50 border dark:border-gray-700",children:e.jsxs("div",{className:"py-1",children:[g?e.jsxs("button",{onClick:X,className:"flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left",children:[e.jsx(de,{className:"w-5 h-5 mr-2"}),"UnSave"]}):e.jsxs("button",{onClick:q,className:"flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left",children:[e.jsx(re,{className:"w-5 h-5 mr-2"}),"Save"]}),e.jsxs("button",{onClick:J,className:"flex items-center px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left",children:[e.jsx("span",{className:"material-icons-outlined text-lg mr-2",children:e.jsx(ue,{className:"w-5 h-5"})}),"Report"]})]})})]}),e.jsxs("p",{className:"dark:text-white",style:{paddingLeft:"12px",paddingBottom:"8px",marginTop:"-8px"},children:[e.jsx("span",{className:"font-semibold"})," ",t.caption]}),e.jsx("div",{className:"relative",children:G==="video"?e.jsxs("div",{onClick:()=>o(!1),onDoubleClick:M,className:"relative min-w-full bg-black sm:min-w-96",children:[e.jsxs("video",{onClick:()=>d(`/reels/${t._id}`),ref:v,className:"w-full max-h-[60vh] objectcovernow",muted:k,loop:!0,autoPlay:c,children:[e.jsx("source",{src:t.file.url,type:`video/${t.file.fileType}`}),"Your browser does not support the video tag."]}),e.jsx("div",{className:"absolute p-4 bottom-2 right-2 z-50",onClick:Z,children:k?e.jsx(me,{className:"text-white text-xl"}):e.jsx(xe,{className:"text-white text-xl"})})]}):e.jsx("img",{onClick:()=>d(`/reels/${t._id}`),onDoubleClick:M,src:t.file.url,alt:"Post Media",className:"w-full object-cover min-h-64 max-h-[500px]"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsxs("div",{className:"flex space-x-4",children:[i?e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:M,className:"transform active:scale-125 transition-transform duration-200",children:e.jsx(z,{className:`w-6 h-6 ${m?"text-red-500 fill-current":"dark:text-white"}`})})," ",e.jsxs("span",{style:{marginLeft:"6px",fontSize:"17px"},className:" dark:text-white",children:[u," ",u>1?"Likes":"Like"]})," "]}):e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:()=>d("/signup"),className:"transform active:scale-125 transition-transform duration-200",children:e.jsx(z,{className:`w-6 h-6 ${m?"text-red-500 fill-current":"dark:text-white"}`})})," ",e.jsxs("span",{className:"font-semibold dark:text-white",children:[u," ",u>1?"Likes":"Like"]})," "]}),i?e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:()=>a(s=>!s),children:e.jsx(A,{className:"w-6 h-6 dark:text-white"})}),e.jsx("button",{onClick:()=>D(!0),children:e.jsx(R,{className:"w-6 h-6 dark:text-white"})})," "]}):e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:()=>d("/signup"),children:e.jsx(A,{className:"w-6 h-6 dark:text-white"})})," ",e.jsx("button",{onClick:()=>d("/signup"),children:e.jsx(R,{className:"w-6 h-6 dark:text-white"})})]})]}),t.createdAt?e.jsx(ke,{createdDate:t.createdAt,longitude:t.user.longitude,lattitude:t.user.lattitude}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{className:"text-gray-500 dark:text-gray-400 text-sm",onClick:()=>a(s=>!s),children:"View all comments"}),e.jsx("p",{className:"text-gray-400 text-xs uppercase",children:pe(t.createdAt)})]}),x&&e.jsxs("div",{ref:y,children:[j&&j.length&&j.map(s=>e.jsxs("div",{className:"flex items-start space-x-4 mb-2",children:[e.jsx("img",{src:s.user.profilePicture,alt:s.user.fullName,className:"w-8 h-8 rounded-full object-cover"}),e.jsxs("div",{className:"flex-grow h-full items-start flex flex-col",children:[e.jsx("p",{className:"font-semibold dark:text-white",children:s.user.fullName}),e.jsx("p",{className:"dark:text-white",children:s.text})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"dark:text-white text-black text-lg cursor-pointer",onClick:()=>O(f=>f===s._id?!1:s._id)}),K===s._id&&e.jsx("div",{className:"absolute top-full right-[21px] mt-[-24px] rounded-sm",children:e.jsx("p",{className:" text-white font-semibold rounded-sm cursor-pointer text-sm p-2 bg-red-500  hover:underline",onClick:()=>W(s._id),children:N.removeLoader?"loading...":"Delete"})})]})]},s._id)),e.jsx(oe,{postId:t.id,createComment:F,loader:N,setLoader:C})]}),e.jsx(ie,{isOpen:U,onClose:()=>D(!1),reelId:t._id})]})]})}export{Ne as default};
