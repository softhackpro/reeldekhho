import{k as F,G as L,r as d,u as C,a as _,b as g,s as b,j as e,d as G,e as O,x as V,c as R,L as U,H as P,M as E,S as I,y as W,z as Z,A as K,D as q}from"./index-BDhOjovP.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=F("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);function J(t){return L({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"32",d:"M416 432 64 80"},child:[]},{tag:"path",attr:{d:"M243.33 98.86a23.89 23.89 0 0 0-25.55 1.82l-.66.51-28.52 23.35a8 8 0 0 0-.59 11.85l54.33 54.33a8 8 0 0 0 13.66-5.66v-64.49a24.51 24.51 0 0 0-12.67-21.71zm8 236.43L96.69 180.69A16 16 0 0 0 85.38 176H56a24 24 0 0 0-24 24v112a24 24 0 0 0 24 24h69.76l92 75.31a23.9 23.9 0 0 0 25.87 1.69A24.51 24.51 0 0 0 256 391.45v-44.86a16 16 0 0 0-4.67-11.3zM352 256c0-24.56-5.81-47.87-17.75-71.27a16 16 0 1 0-28.5 14.55C315.34 218.06 320 236.62 320 256q0 4-.31 8.13a8 8 0 0 0 2.32 6.25l14.36 14.36a8 8 0 0 0 13.55-4.31A146 146 0 0 0 352 256zm64 0c0-51.18-13.08-83.89-34.18-120.06a16 16 0 0 0-27.64 16.12C373.07 184.44 384 211.83 384 256c0 23.83-3.29 42.88-9.37 60.65a8 8 0 0 0 1.9 8.26L389 337.4a8 8 0 0 0 13.13-2.79C411 311.76 416 287.26 416 256z"},child:[]},{tag:"path",attr:{d:"M480 256c0-74.25-20.19-121.11-50.51-168.61a16 16 0 1 0-27 17.22C429.82 147.38 448 189.5 448 256c0 46.19-8.43 80.27-22.43 110.53a8 8 0 0 0 1.59 9l11.92 11.92a8 8 0 0 0 12.92-2.16C471.6 344.9 480 305 480 256z"},child:[]}]})(t)}function Q(t){return L({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M11.553 3.064A.75.75 0 0 1 12 3.75v16.5a.75.75 0 0 1-1.255.555L5.46 16H2.75A1.75 1.75 0 0 1 1 14.25v-4.5C1 8.784 1.784 8 2.75 8h2.71l5.285-4.805a.752.752 0 0 1 .808-.13ZM10.5 5.445l-4.245 3.86a.748.748 0 0 1-.505.195h-3a.25.25 0 0 0-.25.25v4.5c0 .138.112.25.25.25h3c.187 0 .367.069.505.195l4.245 3.86Zm8.218-1.223a.75.75 0 0 1 1.06 0c4.296 4.296 4.296 11.26 0 15.556a.75.75 0 0 1-1.06-1.06 9.5 9.5 0 0 0 0-13.436.75.75 0 0 1 0-1.06Z"},child:[]},{tag:"path",attr:{d:"M16.243 7.757a.75.75 0 1 0-1.061 1.061 4.5 4.5 0 0 1 0 6.364.75.75 0 0 0 1.06 1.06 6 6 0 0 0 0-8.485Z"},child:[]}]})(t)}const X=t=>{const[a,h]=d.useState(!0),[c,n]=d.useState(null),x=C(r=>{var s;return((s=r.post.likes.find(m=>m.id===t))==null?void 0:s.isLiked)||!1}),i=C(r=>{var s;return((s=r.post.likes.find(m=>m.id===t))==null?void 0:s.likeCount)||0}),l=_();return d.useEffect(()=>{if(!t)return;i||(async()=>{var s,m;h(!0);try{const f=await g.get(`/post/getlikes?postId=${t}`);l(b({type:"SET_LIKE",payload:{id:t,likeCount:f.data.likesCount,isLiked:f.data.isCurrUserLiked}})),console.log("hello I am aniket like ",f)}catch(f){n(((m=(s=f==null?void 0:f.response)==null?void 0:s.data)==null?void 0:m.message)||"Something went wrong")}finally{h(!1)}})()},[t,l,i]),{likeCount:i,loading:a,error:c,isLiked:x,likePost:async()=>{if(!t)return;const r=x?i-1:i+1;try{l(b({type:"SET_LIKE",payload:{id:t,likeCount:r,isLiked:!x}}));const s=await g.post(`/post/like?postId=${t}`);console.log(s)}catch{l(b({type:"SET_LIKE",payload:{id:t,likeCount:i,isLiked:x}})),n("Failed to update like status")}}}},ee=()=>{const[t,a]=d.useState([]),[h,c]=d.useState(!1);return{addSavedPost:async l=>{var u,r;c(!0);try{const s=await g.post("/post/addSaved?postId="+l);console.log(s.data)}catch(s){c(!1),console.error((r=(u=s==null?void 0:s.response)==null?void 0:u.data)==null?void 0:r.error)}},getSavedPosts:async()=>{var l,u;try{const r=await g.get("/post/getsaved");a(r.data.savedPosts)}catch(r){console.error((u=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:u.error)}},removeSavedPost:async l=>{var u,r;try{const s=await g.delete("/post/deletesaved",{data:{postId:l}});console.log(s.data.posts),c(!1)}catch(s){console.error((r=(u=s==null?void 0:s.response)==null?void 0:u.data)==null?void 0:r.error)}},savedPosts:t,isSaved:h}};function te(t){return L({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"},child:[]},{tag:"circle",attr:{cx:"12",cy:"10",r:"3"},child:[]}]})(t)}const se=t=>{const[a,h]=d.useState(null);console.log(a==null?void 0:a.lat,a==null?void 0:a.lng,"location lattitude");const[c,n]=d.useState(null),x=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(i=>{const{latitude:l,longitude:u}=i.coords;h({lat:l,lng:u}),n(null)},i=>{n(i.message||"Unable to retrieve your location.")}):n("Geolocation is not supported by this browser.")};return d.useEffect(()=>{x()},[]),e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("span",{onClick:()=>alert("check last day"),className:"flex items-center text-xs",children:[e.jsx(te,{className:"mr-1",style:{height:"22px",width:"22px"}}),e.jsx("span",{style:{fontSize:"15px",color:"blue"},children:"1.4 km"})]})})};function ae(t){const a=new Date,h=new Date(t),c=Math.floor((a.getTime()-h.getTime())/1e3);if(c<60)return`${c}s`;const n=Math.floor(c/60);if(n<60)return`${n}m`;const x=Math.floor(n/60);if(x<24)return`${x}h`;const i=Math.floor(x/24);return i<7?`${i}d`:`${Math.floor(i/7)}w`}const re=t=>{const a=["jpg","jpeg","png","gif","bmp","webp"],h=["mp4","mov","avi","mkv","webm","flv"],c=t==null?void 0:t.toLowerCase();return a.some(n=>c.includes(n))?"image":h.some(n=>c.includes(n))?"video":"unknown"};function ne({post:t}){const a=G(),{isLoggedIn:h}=O(),[c,n]=d.useState(!0),[x,i]=d.useState(!1),{likeCount:l,isLiked:u,likePost:r}=X(t._id),s=C(o=>o.auth.isMute),m=_(),{getComment:f,createComment:$,deleteComment:A,comments:v}=V(t._id),j=d.useRef(null),[w,y]=d.useState({addLoader:!1,removeLoader:!1});ee();const[D,S]=d.useState(!1),k=R(()=>n(!0),()=>n(!1),{threshold:.6});d.useEffect(()=>{k.current&&(c?k.current.play():k.current.pause())},[c]);const N=async()=>{await r(t.id)},z=re(t.file.fileType),T=()=>{m(q(!s))},[H,M]=d.useState(!1),B=o=>{w.removeLoader||(y(p=>({...p,removeLoader:!0})),A(o),M(!1),y(p=>({...p,removeLoader:!1})))};return d.useEffect(()=>{const o=p=>{j.current&&!j.current.contains(p.target)&&i(!1)};return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[]),e.jsxs("div",{className:"solveissue bg-white w-[90vw] sm:w-full dark:bg-gray-800 border dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs(U,{to:`/seller/${t.user._id}`,className:"flex items-center space-x-2",children:[e.jsx("img",{src:t.user.profilePicture,alt:t.user.fullName,className:"w-8 h-8 rounded-full object-cover"}),e.jsx("span",{className:"font-semibold dark:text-white",children:t.user.fullName})]}),e.jsx("button",{className:"dark:text-white",children:e.jsx(Y,{className:"cursor-pointer"})})]}),e.jsxs("p",{className:"dark:text-white",style:{paddingLeft:"12px",paddingBottom:"8px",marginTop:"-8px"},children:[e.jsx("span",{className:"font-semibold"})," ",t.caption]}),e.jsx("div",{className:"relative",children:z==="video"?e.jsxs("div",{onClick:()=>n(!1),onDoubleClick:N,className:"relative min-w-full bg-black sm:min-w-96",children:[e.jsxs("video",{onClick:()=>a(`/reels/${t._id}`),ref:k,className:"w-full max-h-[60vh] objectcovernow",muted:s,loop:!0,autoPlay:c,children:[e.jsx("source",{src:t.file.url,type:`video/${t.file.fileType}`}),"Your browser does not support the video tag."]}),e.jsx("div",{className:"absolute p-4 bottom-2 right-2 z-50",onClick:T,children:s?e.jsx(J,{className:"text-white text-xl"}):e.jsx(Q,{className:"text-white text-xl"})})]}):e.jsx("img",{onClick:()=>a(`/reels/${t._id}`),onDoubleClick:N,src:t.file.url,alt:"Post Media",className:"w-full object-cover min-h-64 max-h-[500px]"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsxs("div",{className:"flex space-x-4",children:[h?e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:N,className:"transform active:scale-125 transition-transform duration-200",children:e.jsx(P,{className:`w-6 h-6 ${u?"text-red-500 fill-current":"dark:text-white"}`})})," ",e.jsxs("span",{style:{marginLeft:"6px",fontSize:"17px"},className:" dark:text-white",children:[l," ",l>1?"Likes":"Like"]})," "]}):e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:()=>a("/signup"),className:"transform active:scale-125 transition-transform duration-200",children:e.jsx(P,{className:`w-6 h-6 ${u?"text-red-500 fill-current":"dark:text-white"}`})})," ",e.jsxs("span",{className:"font-semibold dark:text-white",children:[l," ",l>1?"Likes":"Like"]})," "]}),h?e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:()=>i(o=>!o),children:e.jsx(E,{className:"w-6 h-6 dark:text-white"})}),e.jsx("button",{onClick:()=>S(!0),children:e.jsx(I,{className:"w-6 h-6 dark:text-white"})})," "]}):e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:()=>a("/signup"),children:e.jsx(E,{className:"w-6 h-6 dark:text-white"})})," ",e.jsx("button",{onClick:()=>a("/signup"),children:e.jsx(I,{className:"w-6 h-6 dark:text-white"})})]})]}),t.createdAt?e.jsx(se,{createdDate:t.createdAt}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{className:"text-gray-500 dark:text-gray-400 text-sm",onClick:()=>i(o=>!o),children:"View all comments"}),e.jsx("p",{className:"text-gray-400 text-xs uppercase",children:ae(t.createdAt)})]}),x&&e.jsxs("div",{ref:j,children:[v&&v.length&&v.map(o=>e.jsxs("div",{className:"flex items-start space-x-4 mb-2",children:[e.jsx("img",{src:o.user.profilePicture,alt:o.user.fullName,className:"w-8 h-8 rounded-full object-cover"}),e.jsxs("div",{className:"flex-grow h-full items-start flex flex-col",children:[e.jsx("p",{className:"font-semibold dark:text-white",children:o.user.fullName}),e.jsx("p",{className:"dark:text-white",children:o.text})]}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"dark:text-white text-black text-lg cursor-pointer",onClick:()=>M(p=>p===o._id?!1:o._id)}),H===o._id&&e.jsx("div",{className:"absolute top-full right-[21px] mt-[-24px] rounded-sm",children:e.jsx("p",{className:" text-white font-semibold rounded-sm cursor-pointer text-sm p-2 bg-red-500  hover:underline",onClick:()=>B(o._id),children:w.removeLoader?"loading...":"Delete"})})]})]},o._id)),e.jsx(Z,{postId:t.id,createComment:$,loader:w,setLoader:y})]}),e.jsx(K,{isOpen:D,onClose:()=>S(!1),reelId:t._id})]})]})}export{ne as default};
